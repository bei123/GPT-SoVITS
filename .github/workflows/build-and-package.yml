name: Build and Package Python to EXE and MacOS Application

on:  
  push:  
    branches: [ main ]  
  pull_request:  
    branches: [ main ]  

jobs:  
  build-windows:
    name: Build on Windows
    runs-on: windows-latest
    
    steps:  
    - uses: actions/checkout@v2  
    - name: Set up Python  
      uses: actions/setup-python@v2  
      with:  
        python-version: 3.9
    - name: Cache pip Windows
      uses: actions/cache@v2  
      with:  
        path: ~\.pip  
        key: ${{ runner.os }}-pip-${{ hashFiles('**/requirements.txt') }}  
        restore-keys: |  
          ${{ runner.os }}-pip-
    - name: Install dependencies  
      run: |  
        python -m pip install --upgrade pip  
        pip install -r requirements.txt
        pip install pyinstaller  
    - name: Run tests (Windows)
      run: |
        # Add your test commands here for Windows
        echo "Running tests on Windows"
    - name: Package Python to EXE  
      run: |  
        pyinstaller --noconfirm --onefile --windowed GPT_SoVITS/pyqt.py
    - name: Upload Windows artifact  
      uses: actions/upload-artifact@v2  
      with:  
        name: pyqt-windows.exe  
        path: dist/

  build-macos:
    name: Build on MacOS
    runs-on: macos-latest
    
    steps:
    - uses: actions/checkout@v2
    - name: Set up Python
      uses: actions/setup-python@v2
      with:
        python-version: 3.9
    - name: Cache pip MacOS
      uses: actions/cache@v2
      with:
        path: ~/Library/Caches/pip
        key: ${{ runner.os }}-pip-${{ hashFiles('**/requirements.txt') }}
        restore-keys: |
          ${{ runner.os }}-pip-
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        # Add any MacOS specific dependencies if required
    - name: Run tests (MacOS)
      run: |
        # Add your test commands here for MacOS
        echo "Running tests on MacOS"
    # Add specific steps for packaging your application for MacOS, if necessary
    - name: Upload MacOS artifact
      uses: actions/upload-artifact@v2
      with:
        name: pyqt-macos.exe
        path: dist/
